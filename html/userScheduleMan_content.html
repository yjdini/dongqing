<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
	<head>
		<title></title>
		<meta charset="utf-8">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" href="../css/ui-box.css">
		<link rel="stylesheet" href="../css/ui-base.css">
		<link rel="stylesheet" href="../css/ui-color.css">
		<link rel="stylesheet" href="../css/appcan.icon.css">
		<link rel="stylesheet" href="../css/appcan.control.css">
		<link rel="stylesheet" href="../css/main.css">
		<style type="text/css">
			.b-gra3 {
				border-color: #d8d8d8;
			}
			.uinn-a6 {
				padding: 1em 0.65em 0 0.65em;
			}
			.t-gra4 {
				color: #8c8c8c;
			}
			.uinn-a1 {
				padding: 0.625em;
			}
			.uinn-a7 {
				padding: 0 0.625em;
			}
			.c-wh {
				background-color: #FFF;
			}
			.umar-at1 {
				margin-top: 0.625em;
			}
			.uinn-at1 {
				padding-top: 1em;
			}
			input.ub-f1 {
				padding-left: 2em;
			}
			.sc-bg {
				background-color: #F4F4F4;
			}
			.lis {
				padding: 0.5em 0.75em;
			}
			.dot {
				font-size: 0.4em !important;
				color: #FF0000;
				top: 0.2em;
				position: absolute;
				margin-left: 0.4em;
			}
			.ulev-app1 span {
				width: 1.1em;
				height: 1.1em;
				margin-left: 0.6em;
				border: 1px;
				border-style: solid;
				border-radius: 1.1em;
				background-color: red;
				position: relative;
				top: -4.6em;
				left: 1.46em;
			}
		</style>
	</head>
	<body class="um-vp bc-bg" ontouchstart>
		<div class="ub ub-ver" style="margin-left: 1.25em;margin-right: 1em;margin-top: 1em;">
			<div class="uba b-gra3 uc-a1 c-wh ub uinn-a7 ub-ac">
				<div class="ulev-app1 umw4">
					选择技能
				</div>
				<div class="ub ub-ac umh5 ub-f1">
					<div class="uinput ub ub-f1">
						<input placeholder="" class="input1 selectIsNo" type="text"  readonly=""  id="skillId" style="padding-left:10px"/>
					</div>
				</div>
			</div>
			<div class="uba b-gra3 uc-a1 c-wh ub uinn-a7 ub-ac umar-at1">
				<div class="ulev-app1 umw4">
					预约标题
				</div>
				<div class="ub ub-ac umh5 ub-f1">
					<div class="uinput ub ub-f1">
						<input placeholder="" class="input1 selectIsNo" type="text"   id="scheduleTitle" style="padding-left:10px"/>
					</div>
				</div>
			</div>
			<div class="uba b-gra3 uc-a1 c-wh ub uinn-a7 ub-ac umar-at1">
				<div class="ulev-app1 umw4">
					预约开始时间
				</div>
				<div class="ub ub-ac umh5 ub-f1">
					<div class="uinput ub ub-f1">
						<input placeholder="" class="input1 date" type="text"  readonly="" id="scheduleSdate" style="padding-left:10px"/>
					</div>
				</div>
			</div>
			<div class="uba b-gra3 uc-a1 c-wh ub uinn-a7 ub-ac umar-at1">
				<div class="ulev-app1 umw4">
					预约结束时间
				</div>
				<div class="ub ub-ac umh5 ub-f1">
					<div class="uinput ub ub-f1">
						<input placeholder="" class="input1 date" type="text"  readonly="" id="scheduleEdate" style="padding-left:10px"/>
					</div>
				</div>
			</div>
			<div class="uba b-gra3 uc-a1 c-wh ub uinn-a7 ub-ac umar-at1">
				<div class="ulev-app1 umw4">
					是否提醒
				</div>
				<div class="ub ub-ac umh5 ub-f1">
					<div class="uinput ub ub-f1">
						<input placeholder="" class="input1" type="text"  readonly="" id="scheduleWarn" style="padding-left:10px"/>
					</div>
				</div>
			</div>
			<div class="uba b-gra3 uc-a1 c-wh ub uinn-a7 ub-ac umar-at1">
				<div class="ulev-app1 umw4">
					是否开启
				</div>
				<div class="ub ub-ac umh5 ub-f1">
					<div class="uinput ub ub-f1">
						<input placeholder="" class="input1" type="text"  readonly="" id="scheduleIsopen" style="padding-left:10px"/>
					</div>
				</div>
			</div>
			<div class="uba b-gra3 uc-a1 c-wh ub uinn-a7 ub-ac umar-at1">
				<div class="ulev-app1 umw4">
					备注
				</div>
				<div class="ub ub-ac umh5 ub-f1">
					<div class="uinput ub ub-f1">
						<input placeholder="" class="input1" type="text"  id="scheduleNote" style="padding-left:10px"/>
					</div>
				</div>
			</div>
			<div class="uinn-at1" id="btn">
				<div class="btn ub ub-ac bc-text-head ub-pc bc-btn"   style="border-radius: 10px;">
					<div class="uinn3 fa  umh1 umw1"></div>
					保存
				</div>
			</div>
			<div class="uinn-at1" id="del" style="display:none">
				<div class="btn ub ub-ac bc-text-head ub-pc bc-btn"   style="border-radius: 10px;">
					<div class="uinn3 fa  umh1 umw1"></div>
					删除
				</div>
			</div>
		</div>
		<script src="../script/api.js"></script>
		<script src="../script/jquery-1.9.1.min.js"></script>
		<script src="../script/app.js"></script>
		<script >
			var token = "";
			var rowid = "";
			var skillIds = {};
			var arrays = [];
			var selected = [];
			var selectObj = [];
			var obj;
			var tempSkill = "";
			var convertSkillIds = {};
			apiready = function() {
				var pageParam = api.pageParam;
				rowid = pageParam.rowid;
				obj = api.require('multiSelector');
				api.getPrefs({
					key : 'token'
				}, function(ret, err) {
					token = ret.value;
					if (rowid != "") {
						var parames = {
							values : {
								scheduleId : rowid
							}
						}
						doAjax(LISTMYUSERSCHEDULEBYROWID, "post", parames, function(data) {
							var schedule = data.schedule;
							$("#scheduleTitle").val(schedule.scheduleTitle);
							$("#scheduleSdate").val(convertDate(schedule.scheduleSdate));
							$("#scheduleEdate").val(convertDate(schedule.scheduleEdate));
							$("#scheduleWarn").val(convertScheduleWarn(schedule.scheduleWarn));
							$("#scheduleWarn").attr("realVal", (schedule.scheduleWarn));
							$("#scheduleIsopen").val(convertScheduleIsopen(schedule.scheduleIsopen));
							$("#scheduleIsopen").attr("realVal", (schedule.scheduleWarn));
							$("#scheduleNote").val(schedule.scheduleNote);
							var tabUserSkills = data.tabUserSkills;
							tempSkill = schedule.skillId;
							alert(tempSkill);
							var index = 0;
							for (var i = 0; i < tabUserSkills.length; i++) {
								skillIds[tabUserSkills[i].parame2] = tabUserSkills[i].skillId;
								arrays[index++] = tabUserSkills[i].skillId;
								convertSkillIds[tabUserSkills[i].skillId] = tabUserSkills[i].parame2;
							}
							var array = schedule.skillId.split(",");
							var html = "";
							for (var i = 0; i < array.length; i++) {
								html = html + skillIds[array[i]] + ",";
								for (var j = 0; j < arrays.length; j++) {
									if (skillIds[array[i]] == arrays[j]) {
										selected.push(j);
									}
								}
							}
							html = html.substr(0, html.length - 1);
							$("#skillId").val(html);
						}, function(data) {
						})
						$("#del").show();
						$("#del").click(function() {
							api.confirm({
								title : '提示',
								msg : '确定删除预约信息吗?',
								buttons : ['确定', '取消']
							}, function(ret, err) {
								if (ret.buttonIndex == 1) {
									var parames = {
										values : {
											"scheduleId" : rowid
										}
									}
									doAjax(delUserSchedule, "post", parames, function(data) {
										var flag = data.flag;
										if (flag == "true") {
											api.alert({
												"title" : "提示",
												"msg" : "删除成功"
											}, function(ret, err) {
												api.closeWin({
												});
											});
										}
									}, function(data) {
									})
								}
							});
						});
					} else {
						//添加的时候查询我的技能
						var parames = {
							values : {
								token : token
							}
						}
						doAjax(LISTSKILL, "post", parames, function(data) {
							var tabUserSkills = data.data;
							for (var i = 0; i < tabUserSkills.length; i++) {
								arrays.push(tabUserSkills[i].skillId);
								convertSkillIds[tabUserSkills[i].skillId] = tabUserSkills[i].parame2;
							}
						}, function(data) {
						})
					}
				});
				$(".date").click(function() {
					var thisa = $(this);
					api.openPicker({
						type : 'date_time',
						title : '选择时间'
					}, function(ret, err) {
						var year = ret.year;
						var month = ret.month;
						var day = ret.day;
						var hour = ret.hour;
						var minute = ret.minute;
						thisa.val(year + "-" + month + "-" + day + " " + hour + ":" + minute + ":00");
					});
				});
				$("#skillId").click(function() {
					obj.open({
						content : arrays
					}, function(ret, err) {
						selectObj = [];
						var value = "";
						for (var index in ret.selectAry) {
							selectObj.push(index);
							value = value + ret.selectAry[index] + ",";
						}
						if (value != "") {
							$("#skillId").val(value.substr(0, value.length - 1));
						} else {
							$("#skillId").val("")
						}
					});
					obj.setSelect({
						indexs : selected
					})
				});
				$("#scheduleWarn").click(function() {
					api.actionSheet({
						title : '菜单',
						cancelTitle : '取消',
						buttons : ['是', '否']
					}, function(ret, err) {
						if (ret.buttonIndex <= 2) {
							$("#scheduleWarn").val(convertScheduleWarn(ret.buttonIndex));
							$("#scheduleWarn").attr("realVal", (ret.buttonIndex));
						}
					});
				});
				$("#scheduleIsopen").click(function() {
					api.actionSheet({
						title : '菜单',
						cancelTitle : '取消',
						buttons : ['是', '否']
					}, function(ret, err) {
						if (ret.buttonIndex <= 2) {
							$("#scheduleIsopen").val(convertScheduleIsopen(ret.buttonIndex));
							$("#scheduleIsopen").attr("realVal", (ret.buttonIndex));
						}
					});
				});
				$("#btn").click(function() {
					var skillId = "";
					for (var index in selectObj) {
						skillId = skillId + convertSkillIds[arrays[selectObj[index]]] + ",";
					}
					if (skillId == "") {
						skillId = tempSkill;
					} else {
						skillId = skillId.substr(0, skillId.length - 1);
					}
					var params = {
						values : {
							skillId : skillId,
							token : token,
							scheduleTitle : $("#scheduleTitle").val(),
							scheduleSdate : $("#scheduleSdate").val(),
							scheduleEdate : $("#scheduleEdate").val(),
							scheduleWarn : $("#scheduleWarn").attr("realVal"),
							scheduleIsopen : $("#scheduleIsopen").attr("realVal"),
							scheduleNote : $("#scheduleNote").val(),
							scheduleId : rowid
						}
					}
					doAjax(SAVEORUPDATEUSERSCHEDULE, "post", params, function(data) {
						var flag = data.flag;
						if (flag == "false") {
							api.alert({
								title : "提示",
								msg : data.msg
							}, function(ret, err) {
							});
						} else {
							api.alert({
								title : "提示",
								msg : "预约更新成功"
							}, function(ret, err) {
								api.closeWin({
								});
							});
						}
					}, function(data) {
					})
				});
			}
		</script>
	</body>
</html>